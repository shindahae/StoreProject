<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sist.com.vo.BmProductBean">
	<select id="getBmTotalRow" resultType="int">
		SELECT COUNT(*) FROM
		BMSTOREPRODUCT
	</select>

	<sql id="plist">
		SELECT CATEGORY, NO,
		PRODUCTNAME, PRODUCTCODE, PRODUCTPRICE,
		PRODUCTUNIT,
		PRODUCTDELIVERY,
		PRODUCTCOUNT, PRODUCTPRODUCTION,
		PRODUCTIMAGE
		FROM
		BMSTOREPRODUCT
	</sql>

	<select id="productList" resultType="bmproduct">
		<include refid="plist"></include>
	</select>

	<select id="productSelectList" resultType="bmproduct"
		parameterType="String">
		<include refid="plist"></include>
		WHERE
		CATEGORY=#{category}
	</select>

	<select id="productDetail" parameterType="int" resultType="bmproduct">
		<include refid="plist"></include>
		WHERE
		PRODUCTCODE=#{productcode}
	</select>

	<select id="mainList" resultType="bmproduct">
		SELECT CATEGORY, NO,
		PRODUCTNAME, PRODUCTCODE, PRODUCTPRICE,
		PRODUCTUNIT,
		PRODUCTDELIVERY,
		PRODUCTCOUNT, PRODUCTPRODUCTION,
		PRODUCTIMAGE FROM(
		<include refid="plist"></include>
		ORDER BY
		PRODUCTNAME)
		WHERE ROWNUM BETWEEN 1 AND 20
	</select>

	<select id="productSelectItem" parameterType="String"
		resultType="bmproduct">
		<include refid="plist"></include>
		WHERE CATEGORY=#{value} AND ROWNUM BETWEEN 1 AND 2
	</select>

	<select id="eventList" resultType="bmevent">
		SELECT E.NO, E.PRODUCTCODE,
		E.STARTDATE,
		E.ENDDATE, E.AMOUNT, E.SALE,
		P.PRODUCTNAME, P.PRODUCTPRICE,
		P.PRODUCTUNIT, P.PRODUCTIMAGE
		FROM BMEVENT E, BMSTOREPRODUCT P
		WHERE
		E.PRODUCTCODE=P.PRODUCTCODE AND E.ENDDATE>SYSDATE
		ORDER BY E.ENDDATE,
		E.STARTDATE
	</select>

	<select id="jalList" resultType="bmproduct">
		SELECT RM,CATEGORY,
		NO,PRODUCTNAME, PRODUCTCODE,
		PRODUCTPRICE,PRODUCTUNIT,PRODUCTDELIVERY,PRODUCTCOUNT,
		PRODUCTPRODUCTION,PRODUCTIMAGE
		FROM BMSTOREPRODUCT B,(
		SELECT ROWNUM RM,
		STOREPRODUCTCODE, COUNT
		FROM(
		SELECT STOREPRODUCTCODE, SUM(ORDERCOUNT)
		COUNT FROM ORDERLIST GROUP BY
		STOREPRODUCTCODE ORDER BY SUM(ORDERCOUNT)
		DESC)
		WHERE ROWNUM BETWEEN 1 AND 19) C
		WHERE
		B.PRODUCTCODE=C.STOREPRODUCTCODE
		ORDER BY RM
	</select>

	<insert id="cartAdd" parameterType="bmcart">
		<selectKey keyProperty="no" order="BEFORE" resultType="int">
			SELECT BMCART_SEQ.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO BMCART
		VALUES(#{no},SYSDATE,#{ownerno},#{productcode},#{cartamount})
	</insert>

	<select id="cartcheck" parameterType="java.lang.String"
		resultType="int">
		SELECT COUNT(*) FROM BMCART WHERE PRODUCTCODE IN
		#{productcode}
	</select>

	<select id="cartList" resultType="bmcartlist">
		SELECT C.NO NO,C.PRODUCTCODE
		PRODUCTCODE,C.CARTAMOUNT CARTAMOUNT, P.PRODUCTNAME PRODUCTNAME,
		P.PRODUCTPRICE PRODUCTPRICE,
		P.PRODUCTIMAGE PRODUCTIMAGE
		FROM
		BMSTOREPRODUCT P,(
		SELECT NO, OWNERNO, PRODUCTCODE, CARTAMOUNT FROM
		BMCART
		WHERE OWNERNO='TESTOWNER01') C
		WHERE P.PRODUCTCODE=C.PRODUCTCODE
	</select>

	<update id="cartmodify" parameterType="HashMap">
		UPDATE BMCART SET
		CARTAMOUNT=#{cartamount} WHERE NO=#{no}
	</update>

	<delete id="alldelete" parameterType="java.lang.String">
		DELETE FROM BMCART WHERE
		OWNERNO=#{ownerno}
	</delete>

	<delete id="checkdelete" parameterType="java.lang.String">
		DELETE FROM BMCART WHERE
		PRODUCTCODE=#{productcode}
	</delete>

	<select id="selectcart" parameterType="java.lang.String" resultType="bmcart">
		SELECT
		NO,CARTDATE,OWNERNO,PRODUCTCODE,CARTAMOUNT
		FROM BMCART WHERE
		PRODUCTCODE=#{productcode}
	</select>

	<insert id="checkorder" parameterType="bmorder">
		<selectKey keyProperty="no" order="BEFORE" resultType="int">
			SELECT SEQ_ORDERLIST_ORDERNO.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO ORDERLIST
		VALUES(#{no},SYSDATE,#{ownerno},#{productcode},#{orderamount},'배송준비중')
	</insert>
</mapper>
